
## Install nginx
packages:
  yum:
    nginx: []


## Stop apache, add nginx / php-fpm boot up and environment config
commands:
  001_time_zone:
    command: ln -f -s /usr/share/zoneinfo/Europe/Paris /etc/localtime

  # Stop apache completely
  011_httpd_conf:
    test: service httpd status | grep running
    command: service httpd stop
  020_nginx_boot:
    command: chkconfig nginx on

## Script that will be executed AFTER the application is installed and BEFORE the deployment of instance
container_commands:

  # Our custom nginx conf
  010_nginx_conf:
    command: cp -f .ebextensions/setup/conf/nginx/nginx.conf /etc/nginx/nginx.conf

  # Restart nginx
  011_nginx_restart:
    command: service nginx restart

  # Install app
  020_install_dependencies:
    command: cd /var/app/current && npm run install -g

  021_build_app:
    command: cd /var/app/current && REACT_APP_STAGE=staging CI=true npm run build